---
- name: Mettre à jour le système et installer htop
  hosts: all
  become: yes
  tasks:
    - name: Vérification de la connectivité
      ping:

    - name: Vérification de la disponibilité des sockets
      wait_for:
      host: "{{ inventory_hostname }}"
      port: 80
      state: started
      timeout: 5

    - name: Vérification de la version d'Ansible
      command: ansible --version
      register: ansible_version

    - name: Affichage de la version d'Ansible
      debug:
        var: ansible_version.stdout_lines

    - name: Mettre à jour la liste des paquets
      ansible.builtin.apt:
        update_cache: yes

    - name: Mettre à jour tous les paquets installés
      ansible.builtin.apt:
        upgrade: safe

    - name: Installer le paquet htop
      ansible.builtin.apt:
        name: htop
        state: present

    - name: Supprimer les paquets inutiles
      ansible.builtin.apt:
        autoremove: yes
